// N·∫°p th∆∞ vi·ªán Math.js
const mathScript = document.createElement('script');
mathScript.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.min.js";
document.head.appendChild(mathScript);

mathScript.onload = () => {
  const input = document.getElementById("expression");
  const solveBtn = document.getElementById("solveBtn");
  const solution = document.getElementById("solution");
  const chatLog = document.getElementById("chat-log");
  const sendBtn = document.getElementById("send-btn");
  const userInput = document.getElementById("user-input");

  // üßÆ Gi·∫£i ƒë·∫°o h√†m
  solveBtn.addEventListener("click", () => {
    const expr = input.value.trim();
    if (!expr) {
      solution.innerHTML = "‚ùóVui l√≤ng nh·∫≠p bi·ªÉu th·ª©c.";
      return;
    }

    try {
      const simplified = math.simplify(expr);
      const derivative = math.derivative(simplified, 'x');
      const steps = [
        `B∆∞·ªõc 1Ô∏è‚É£: Bi·ªÉu th·ª©c ban ƒë·∫ßu: <b>${expr}</b>`,
        `B∆∞·ªõc 2Ô∏è‚É£: R√∫t g·ªçn l·∫°i: <b>${simplified}</b>`,
        `B∆∞·ªõc 3Ô∏è‚É£: L·∫•y ƒë·∫°o h√†m theo x.`,
        `B∆∞·ªõc 4Ô∏è‚É£: K·∫øt qu·∫£ cu·ªëi c√πng: <b>${derivative}</b>`
      ];
      solution.innerHTML = steps.join('<br>');
    } catch (err) {
      solution.innerHTML = "‚ö†Ô∏è L·ªói c√∫ ph√°p, vui l√≤ng ki·ªÉm tra l·∫°i bi·ªÉu th·ª©c.";
    }
  });

  // üí¨ Chat AI c∆° b·∫£n
  const responses = {
    "ai t·∫°o ra b·∫°n": "M√¨nh ƒë∆∞·ª£c t·∫°o ra b·ªüi ƒêo√†n Anh Qu√¢n ‚Äî ng∆∞·ªùi c√≥ ni·ªÅm ƒëam m√™ k·∫øt h·ª£p to√°n h·ªçc v√† c√¥ng ngh·ªá.",
    "b·∫°n t√™n g√¨": "M√¨nh l√† AI HQD ‚Äî tr·ª£ l√Ω h·ªçc to√°n th√¥ng minh.",
    "b·∫°n bi·∫øt g√¨ v·ªÅ ƒë·∫°o h√†m": "ƒê·∫°o h√†m cho bi·∫øt t·ªëc ƒë·ªô thay ƒë·ªïi c·ªßa h√†m s·ªë, m√¨nh c√≥ th·ªÉ t√≠nh v√† gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc cho b·∫°n!",
    "xin ch√†o": "Xin ch√†o! M√¨nh l√† HQD AI, s·∫µn s√†ng gi√∫p b·∫°n gi·∫£i to√°n!",
    "c·∫£m ∆°n": "R·∫•t vui ƒë∆∞·ª£c gi√∫p b·∫°n üíô"
  };

  sendBtn.addEventListener("click", () => {
    const text = userInput.value.trim();
    if (!text) return;
    addMessage("user", text);

    let reply = "M√¨nh ch∆∞a hi·ªÉu r√µ c√¢u h·ªèi, b·∫°n c√≥ th·ªÉ n√≥i l·∫°i kh√¥ng?";
    for (let key in responses) {
      if (text.toLowerCase().includes(key)) {
        reply = responses[key];
        break;
      }
    }

    setTimeout(() => addMessage("ai", reply), 500);
    userInput.value = "";
  });

  function addMessage(sender, message) {
    const div = document.createElement("div");
    div.classList.add("chat-message", sender);
    div.innerHTML = `<b>${sender === "user" ? "üë§ B·∫°n" : "ü§ñ HQD AI"}:</b> ${message}`;
    chatLog.appendChild(div);
    chatLog.scrollTop = chatLog.scrollHeight;
  }
};
